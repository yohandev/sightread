{
  "version": 3,
  "sources": ["wasm-stub:/Users/yohan/dev/sightread/src/rs/mod.wasm", "../src/rs/mod.js", "../src/js/draw.js", "../src/js/mic.js", "../src/js/main.js"],
  "sourcesContent": ["\n            import wasm from \"/Users/yohan/dev/sightread/src/rs/mod.wasm\"\n\n            export default (imports) => WebAssembly\n                .instantiate(wasm, imports)\n                .then(result => result.instance.exports)\n            ", "import load from './mod.wasm'\n\n/** @type {WebAssembly.Exports} */\nlet exports = undefined;\n\n/** bindings over WASM module */\nexport default\n{\n    /** begins loading the WASM module */\n    async load()\n    {\n        exports = await load();\n\n        console.log(exports)\n    },\n\n    /** @returns {WebAssembly.Memory} */\n    get memory() { return exports.memory },\n\n    /** a wrapper over wasm memory, with 32-bit elements */\n    arr: class WasmArray\n    {\n        /**\n         * create a new wrapper over wasm memory \n         * @param {number} ptr byte offset, aligned to 32-bits\n         * @param {number} len number of elements\n         */\n        constructor(ptr, len)\n        {\n            /** @type {ArrayBuffer} */\n            this.buf = () => exports.memory.buffer;\n\n            this.ptr = ptr;\n            this.len = len;\n        }\n        /** interpret this array as an `i32[]` */\n        get i32() { return new Int32Array(this.buf(), this.ptr, this.len) }\n        /** interpret this array as an `f32[]` */\n        get f32() { return new Float32Array(this.buf(), this.ptr, this.len) }\n    },\n    /**\n     * allocate a new array in WASM memory\n     * @param {number} len length of array to allocate\n     */\n    alloc(len)\n    {\n        return new this.arr(exports.alloc32(len), len)\n    },\n    /**\n     * deallocate an array allocated with `alloc` in WASM memory\n     * @param {WasmArray} arr array to deallocate\n     */\n    dealloc(arr)\n    {\n        exports.dealloc32(arr.ptr, arr.len);\n    },\n    /**\n     * extracts the frequencies out of a signal, overwriting the input\n     * buffer of `f32` samples with half as many `(f32, f32)`(packed)\n     * tuples representing (frequency, amplitude)\n     * \n     * @param {WasmArray} pcm input samples, of some power of 2 length\n     * @param {number} fs sampling frequency\n     * @returns {WasmArray} (frequency, amplitude)[pcm.len / 2]\n     */\n    frequencies(pcm, fs)\n    {\n        exports.frequencies(pcm.ptr, pcm.len, fs);\n\n        return pcm;\n    },\n    /**\n     * performs the hamming windowing function to the buffer of PCM\n     * data\n     * @param {WasmArray} pcm audio signal data\n     * @returns {WasmArray} pcm passed in\n     */\n    hamming(pcm)\n    {\n        exports.hamming(pcm.ptr, pcm.len);\n\n        return pcm;\n    }\n}", "const w = window.innerWidth;\nconst h = window.innerHeight;\n\nconst svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\nconst lin = document.createElementNS('http://www.w3.org/2000/svg', 'polyline');\nconst txt = document.createElementNS('http://www.w3.org/2000/svg', 'foreignObject');\nconst div = document.createElement('p');\n\nsvg.setAttribute('width', w);\nsvg.setAttribute('height', h);\n\nlin.style.stroke = '#000';\nlin.style.strokeWidth = '5px';\nlin.style.fill = 'none';\ndiv.style = 'font-size: 32px; overflow: auto;'\n\ntxt.setAttribute('x', w / 4);\ntxt.setAttribute('y', 150);\ntxt.setAttribute('width', 300);\ntxt.setAttribute('height', 300);\n\nsvg.appendChild(lin);\nsvg.appendChild(txt);\ntxt.appendChild(div);\ndocument.body.appendChild(svg);\n\nexport default\n{\n    pts: \"\",\n    begin()\n    {\n        this.pts = \"\";\n        this.txt = \"\";\n    },\n    add(frq, amp, len)\n    {\n        this.pts += `${frq * (w / len)}, ${h - 30 - amp * (h * 0.9)} `\n    },\n    end()\n    {\n        lin.setAttribute('points', this.pts);\n        div.textContent = this.txt;\n    },\n    text(str)\n    {\n        this.txt += `${str}\\n`;\n    }\n}", "/**\n * creates a new audio processor, working with `samples`\n * samples of PCM data from microphone audio input\n * \n * @param {number} samples number of samples desired at once\n * @param {function(Float32Array, number)} processor audio processor(samples, sampling frequency)\n */\nexport default async (samples, processor) =>\n{\n    /** @type {AudioContext} */\n    const context = new (window.AudioContext || window.webkitAudioContext)();\n    /** @type {MediaStreamAudioSourceNode} */\n    const source = context\n        .createMediaStreamSource(await navigator.mediaDevices\n            .getUserMedia({ audio: true, video: false })\n        );\n    /** @type {ScriptProcessorNode} */\n    const recorder = (context.createScriptProcessor || context.createJavaScriptNode).call(context, samples, 1, 1);\n    \n    // TODO use modern API https://developer.mozilla.org/en-US/docs/Web/API/AudioWorkletNode\n\n    // run processor on raw audio samples\n    recorder.onaudioprocess = e => processor(e.inputBuffer.getChannelData(0), context.sampleRate);\n    // link new recorder\n    source.connect(recorder);\n    recorder.connect(context.destination);\n}", "import wasm from '../rs/mod'\nimport draw from './draw';\nimport mic from './mic';\n\nconst main = async () =>\n{\n    await wasm.load();\n\n    const pcm = wasm.alloc(4096);\n\n    await mic(4096, (samples, fs) =>\n    {\n        // copy over data\n        pcm.f32.set(samples);\n        // FFT\n        let fft = wasm.frequencies(wasm.hamming(pcm), fs);\n        // frequencies past threshold\n        let frq = [];\n\n        // draw\n        draw.begin()\n        for (let i = 0; i < pcm.len; i += 2)\n        {\n            if (fft.f32[i + 1] > 0.0035)\n            {\n                frq.push({ frq: fft.f32[i], amp: fft.f32[i + 1] });\n            }\n            draw.add(fft.f32[i], Math.max(fft.f32[i + 1], 0.001) * 10, pcm.len);\n        }\n        // frequencies\n        frq\n            .sort((a, b) => b.amp - a.amp)\n            .forEach(n => draw\n                .text(`${n.frq.toPrecision(5)}hz - ${n.amp.toPrecision(5)}`)\n            );\n        // draw\n        draw.end()\n    })\n    //wasm.dealloc(arr);\n}\n\nmain();"],
  "mappings": "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",
  "names": []
}
